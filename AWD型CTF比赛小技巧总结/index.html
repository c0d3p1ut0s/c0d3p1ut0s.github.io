<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>AWD型CTF比赛小技巧总结 | c0d3p1ut0s</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-111240445-1','auto');ga('send','pageview');</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">AWD型CTF比赛小技巧总结</h1><a id="logo" href="/.">c0d3p1ut0s</a><p class="description">程序员 安全  codeplutos</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">AWD型CTF比赛小技巧总结</h1><div class="post-meta">Jul 11, 2018<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><a data-disqus-identifier="AWD型CTF比赛小技巧总结/" href="/AWD型CTF比赛小技巧总结/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>最近参加了两次AWD型CTF比赛，所谓AWD型比赛，就是选手既是维护者，需要维护分配给自己的防守机，也是攻击者，需要攻击对手的防守机，拿到flag。发现一些小套路，总结一下。</p>
<a id="more"></a>
<h2 id="0x01-套路"><a href="#0x01-套路" class="headerlink" title="0x01 套路"></a>0x01 套路</h2><p>套路太深，逐个写太麻烦了，我画了一个脑图如下，其中关键的部分我会在下面提到。</p>
<p><img src="https://i.loli.net/2018/07/11/5b45bb55a8a62.png" alt="naotu.png"></p>
<p>先从防开始说吧</p>
<ul>
<li>备份：拿到服务器权限之后第一件事应该是备份了。记得把web目录和数据库都备份一下。</li>
<li>进程监控：非root用户是无法隐藏进程的，进程监控能快速找到对手留下的后门/运行的命令。</li>
<li>日志监控：这个重要性不多说，可以自己事先写个脚本过滤一下，至少得先过滤出返回码是200的请求吧。</li>
<li>WAF：这个慎重上，上的话过滤的内容一定要少。可以考虑把flag关键字，或者flag服务器地址过滤一下。如果准备时间充足的话也可以伪造返回。</li>
</ul>
<p>AWD比赛还是以攻为主，以攻为守。在整个比赛中，拿到flag是最核心的目的。整个攻击过程都以这个目的为中心。在比赛的过程中，绝大多数情况都是利用<strong>多线程批量化攻击脚本</strong>进行攻击。这个脚本可以在赛前基本写好，在比赛时，只需要完善一些基本的函数就可以了。可以说，这个脚本的质量决定了你的攻击效率。注意好以下几点，能够事半功倍。</p>
<ul>
<li><strong>合理抽象</strong>：方法不要太抽象，也不要写得像意大利面，很自然的把攻击过程抽象成flag获取，flag去重，flag提交三个方法即可。我在脚本中，关于flag操作的方法都以flag开头，这样，在比赛时写代码时，即使忘记函数名，只要是对flag做操作，IDE都会提示有哪些函数。</li>
<li><strong>单元测试+集成测试</strong>：一些方法必定在比赛现场完善，例如flag提交和flag获取，但是对这些方法的单元测试和集成测试函数可以在赛前写好，方便在赛时迅速定位问题，调试bug。</li>
<li><strong>异常处理</strong>：CTF比赛环境不稳定非常常见，比如flag提交服务器挂掉，这样，赛前要考虑到这些情况，如果flag服务器挂掉，在异常处理中，可以把flag写入flag文件中，稍后再提交。</li>
<li><strong>合理输出</strong>：不要动不动就输出信息到控制台，像http请求中超时异常很常见的，直接忽略就好，输出信息太多，在多线程情况下根本看不过来。只输出关键步骤的关键信息，最好能根据输出判断批量化攻击的运行状态。<br>另外，在利用漏洞找到flag和写好批量攻击脚本之间肯定有时间差，这个时候，其他队友先手动攻击，提交flag，直到负责脚本编写的同学完成代码编写和调试。</li>
</ul>
<p>在比赛中，为了快速写出flag获取的代码，我用了burp的requests插件，这个插件可以把burp suite拦截下来的包转换成python requests代码，非常方便。生成的代码大概如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flag_submit</span><span class="params">(flag)</span>:</span></span><br><span class="line">    <span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">    burp0_url = <span class="string">""</span></span><br><span class="line">    burp0_cookies = &#123;<span class="string">"PHPSESSID"</span>: <span class="string">"30bnlp2apsc9acu5g1qf650es4"</span>&#125;</span><br><span class="line">    burp0_headers = &#123;<span class="string">"Accept"</span>: <span class="string">"*/*"</span>, <span class="string">"Origin"</span>: <span class="string">"http://100.100.100.200"</span>, <span class="string">"X-Requested-With"</span>: <span class="string">"XMLHttpRequest"</span>,</span><br><span class="line">                        <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36"</span>,</span><br><span class="line">                        <span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded; charset=UTF-8"</span>,</span><br><span class="line">                        <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, <span class="string">"Accept-Language"</span>: <span class="string">"zh-CN,zh;q=0.9"</span>, <span class="string">"Connection"</span>: <span class="string">"close"</span>&#125;</span><br><span class="line">    burp0_data = &#123;<span class="string">"answerVal"</span>: flag&#125;</span><br><span class="line">    r=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)</span><br></pre></td></tr></table></figure></p>
<p>一般来说没什么问题，但是如果需要在每台机器上都登录，再运行poc，才能获取flag，就要注意：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flag_get</span><span class="params">(ip)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> requests.Session() <span class="keyword">as</span> s:</span><br><span class="line"></span><br><span class="line">        burp0_url = <span class="string">"http://"</span>+ip+<span class="string">"/"</span></span><br><span class="line">        burp0_cookies = &#123;<span class="string">"JSESSIONID"</span>: <span class="string">"84CBC07052E955A5D2381955B312187C"</span>, <span class="string">"ZVh5_2132_saltkey"</span>: <span class="string">"o5O3yFez"</span>,</span><br><span class="line">                         <span class="string">"ZVh5_2132_lastvisit"</span>: <span class="string">"1530254636"</span>, <span class="string">"ZVh5_2132_sid"</span>: <span class="string">"LAdoUM"</span>,</span><br><span class="line">                         <span class="string">"ZVh5_2132_lastact"</span>: <span class="string">"1530258236%09connect.php%09"</span>&#125;</span><br><span class="line">        burp0_headers = &#123;<span class="string">"Cache-Control"</span>: <span class="string">"max-age=0"</span>, <span class="string">"Origin"</span>: <span class="string">"http://102.102.102.82"</span>,</span><br><span class="line">                         <span class="string">"Upgrade-Insecure-Requests"</span>: <span class="string">"1"</span>, <span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span>,</span><br><span class="line">                         <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36"</span>,</span><br><span class="line">                         <span class="string">"Accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8"</span>,</span><br><span class="line">                         <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>,</span><br><span class="line">                         <span class="string">"Accept-Language"</span>: <span class="string">"zh-CN,zh;q=0.9"</span>, <span class="string">"Connection"</span>: <span class="string">"close"</span>&#125;</span><br><span class="line">        burp0_data = &#123;<span class="string">"password"</span>: <span class="string">"password"</span>, <span class="string">"doing"</span>: <span class="string">"login"</span>&#125;</span><br><span class="line">        <span class="comment"># 这里没有指定cookies</span></span><br><span class="line">        s.post(burp0_url, headers=burp0_headers, data=burp0_data)</span><br></pre></td></tr></table></figure></p>
<p>这里使用requests.Session()来保持登录，注意，在s.post中，不能指定cookies，否则会用指定的cookies去操作，那每个ip都是这个cookie，相当于没有登录。</p>
<p>如果主办方没有给防守机的权限的话，需要自己攻破防守机，获取权限，再寻找flag。找到漏洞攻击之后，不要急于找flag或者加固，先构造一个交互式的shell，例如上传一个菜刀马，用菜刀的虚拟终端，或者反弹shell。一个交互式的shell比一个命令执行的马不知好用到哪里去了。磨刀不误砍柴工。</p>
<p>有的比赛flag会定时刷新，这种比较考验选手的攻防对抗，如果没有root的话，批量种马和后门无非就是那几种，不赘述，提一点小技巧，你可能批量给别人的机器种了几个马，但是一定要给自己的防守机多留几个后门/木马，如果在攻防对抗的后期，所有队伍的web服务都被打挂了，你在别人机器上留的马都没有用了，你还有自己机器的控制权，发起DOS攻击的队伍肯定已经种好了后门，利用好这个后门，可以反客为主打全场。</p>
<p>攻防相对，你也可以在后期种下自己的木马后，把web服务都打挂，一来可以使其他队伍扣分，二来可以使web木马全部失去作用，大部分队伍都失去了权限。</p>
<h2 id="0x02-结语"><a href="#0x02-结语" class="headerlink" title="0x02 结语"></a>0x02 结语</h2><p>CTF比赛最核心的还是选手的安全水平，攻防能力，是为道。以上只是一些术，一些能快速得分的方法，希望能给读者一些帮助。</p>
</div><div class="tags"><a href="/tags/CTF/">CTF</a><a href="/tags/AWD/">AWD</a><a href="/tags/攻防对抗/">攻防对抗</a></div><div class="post-nav"><a href="/fortify-sca-rules解密工具/" class="pre">fortify sca rules解密工具</a><a href="/攻击Java沙箱/" class="next">攻击Java沙箱</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = 'c0d3p1ut0s';
var disqus_identifier = 'AWD型CTF比赛小技巧总结/';
var disqus_title = 'AWD型CTF比赛小技巧总结';
var disqus_url = 'http://c0d3p1ut0s.github.io/AWD型CTF比赛小技巧总结/';
$('.btn_click_load').click(function() {
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  $('.btn_click_load').css('display','none');
});
$.ajax({
  url: 'https://disqus.com/next/config.json',
  timeout: 3000,
  type: 'GET',
  success: (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $('.btn_click_load').css('display','none');
  })(),
  error: function() {
    $('.btn_click_load').css('display','block');
  }
});</script><script id="dsq-count-scr" src="//c0d3p1ut0s.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://c0d3p1ut0s.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Web安全/" style="font-size: 15px;">Web安全</a> <a href="/tags/aboutme/" style="font-size: 15px;">aboutme</a> <a href="/tags/SQL注入/" style="font-size: 15px;">SQL注入</a> <a href="/tags/Java安全/" style="font-size: 15px;">Java安全</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/代码审计/" style="font-size: 15px;">代码审计</a> <a href="/tags/破解/" style="font-size: 15px;">破解</a> <a href="/tags/CTF/" style="font-size: 15px;">CTF</a> <a href="/tags/AWD/" style="font-size: 15px;">AWD</a> <a href="/tags/攻防对抗/" style="font-size: 15px;">攻防对抗</a> <a href="/tags/MyBatis/" style="font-size: 15px;">MyBatis</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/RASP/" style="font-size: 15px;">RASP</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/Java字节码/" style="font-size: 15px;">Java字节码</a> <a href="/tags/java-security-manager/" style="font-size: 15px;">java security manager</a> <a href="/tags/bypass/" style="font-size: 15px;">bypass</a> <a href="/tags/沙箱/" style="font-size: 15px;">沙箱</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/fortify-sca-rules解密工具/">fortify sca rules解密工具</a></li><li class="post-list-item"><a class="post-list-link" href="/AWD型CTF比赛小技巧总结/">AWD型CTF比赛小技巧总结</a></li><li class="post-list-item"><a class="post-list-link" href="/攻击Java沙箱/">攻击Java沙箱</a></li><li class="post-list-item"><a class="post-list-link" href="/MyBatis框架中常见的SQL注入/">MyBatis框架中常见的SQL注入</a></li><li class="post-list-item"><a class="post-list-link" href="/简单说说MySQL-Prepared-Statement/">简单说说MySQL Prepared Statement</a></li><li class="post-list-item"><a class="post-list-link" href="/Java-RASP浅析-以百度OpenRASP为例/">Java RASP浅析--以百度OpenRASP为例</a></li><li class="post-list-item"><a class="post-list-link" href="/译-使用ASM对Java字节码插桩/">[译]使用ASM对Java字节码插桩</a></li><li class="post-list-item"><a class="post-list-link" href="/BurpUnlimited分析/">BurpUnlimited分析</a></li><li class="post-list-item"><a class="post-list-link" href="/一类PHP-RASP的实现/">一类PHP RASP的实现</a></li><li class="post-list-item"><a class="post-list-link" href="/about/">About</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//c0d3p1ut0s.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://blog.nudtcat.org" title="s1m0n的博客" target="_blank">s1m0n的博客</a><ul></ul><a href="http://www.yinwang.org/" title="当然我在扯淡" target="_blank">当然我在扯淡</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">c0d3p1ut0s.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>